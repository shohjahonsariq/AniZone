{% extends 'base.html' %}
{% block content %}
{% block title %}AniZone - {{ anime.title }}{% endblock %}
<div class="container-xxl px-2 px-md-4 mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="anime-pro-card mb-5">
                <div class="row g-0 flex-md-row flex-column-reverse">
                    <div class="col-md-6 d-flex flex-column p-4 anime-pro-info">
                        <h1 class="anime-pro-title mb-2">{{ anime.title }}</h1>
                        <div class="mb-3 d-flex gap-2 align-items-center flex-wrap">
                            <span class="badge anime-pro-badge-main"><i class="fa-solid fa-eye me-1"></i> {{ anime.views }}</span>
                            <!-- <span class="badge anime-pro-badge"><i class="fa-solid fa-calendar-days me-1"></i> {{ anime.created_at|date:"d.m.Y H:i" }}</span>                         -->
                            <div class="d-flex align-items-center">
                                {% if user.is_authenticated %}
                                    <form method="post" action="{% url 'like_anime' anime.pk %}">
                                        {% csrf_token %}
                                        <button class="btn anime-pro-like-btn {% if has_liked %}liked{% endif %}">
                                            <i class="fa-solid fa-thumbs-up"></i> {{ anime.total_likes }}
                                        </button>
                                    </form>
                                {% else %}
                                    <a href="{% url 'account_login' %}" class="btn btn-outline-danger">Kirish orqali like bering</a>
                                {% endif %}
                            </div>
                        </div>

                        <pre class="anime-pro-desc mb-4">{{ anime.description }}</pre>
         

                    </div>
                    <div class="col-md-6 anime-pro-cover-wrap d-flex align-items-center justify-content-center">
                        <img width="100%" src="{{ anime.image.url }}" class="anime-pro-cover" alt="{{ anime.title }}">
                    </div>
                </div>
            </div>
            
            <div class="mb-4">
              <div class="anime-episode-grid">
                {% for episode in episodes %}
                  <a href="{% url 'episode_detail' episode.pk %}" class="anime-episode-badge">
                    <i class="fa-solid fa-play me-1"></i>{{ episode.episode_number }}-qism
                  </a>
                {% endfor %}
              </div>
            </div>

            <!-- Izohlar -->
            <div class="anime-pro-comments mb-5">
                <h4 class="mb-3"><i class="fa-solid fa-comments me-2"></i>Izohlar</h4>
                {% if user.is_authenticated %}
                    <form method="post" class="mb-3">
                        {% csrf_token %}
                        <textarea name="text" rows="3" class="anime-pro-textarea" placeholder="Izoh yozing..."></textarea>
                        <button type="submit" class="btn anime-pro-comment-btn mt-2">Yuborish</button>
                    </form>
                {% else %}
                    <p><a href="{% url 'account_login' %}" class="text-info">Izoh yozish uchun tizimga kiring</a></p>
                {% endif %}
                <div class="anime-pro-comment-list mt-4">
                    {% for comment in comments %}
                        <div class="anime-pro-comment mb-3 d-flex align-items-start gap-3">
                            <div class="anime-pro-comment-avatar flex-shrink-0">
                                {% if comment.user.userprofile.profile_image %}
                                    <img src="{{ comment.user.userprofile.profile_image }}" class="rounded-circle" width="44" height="44" alt="Profil rasmi">
                                {% else %}
                                    <img src="https://ui-avatars.com/api/?name={{ comment.user.username|urlencode }}&background=ff4c60&color=fff&size=44" class="rounded-circle" width="44" height="44" alt="Profil rasmi">
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center gap-2 mb-1">
                                    <strong>{{ comment.user.get_full_name|default:comment.user.username }}</strong>
                                </div>
                                <div class="anime-pro-comment-text">{{ comment.text }}</div>
                            </div>
                        </div>
                    {% empty %}
                        <p class="text-muted">Hozircha izoh yoâ€˜q.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.anime-pro-card {
    border-radius: 2.2rem;
    background: rgba(34,36,40,0.97);
    /* box-shadow: 0 8px 32px 0 #23252640, 0 2px 24px 0 #ff4c6040; */
    /* border: 2px solid #f29824; */
    border: 1px solid #ffffff43;
    overflow: hidden;
    margin-bottom: 2.5rem;
}
.anime-pro-cover-wrap {
    min-height: 340px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.anime-pro-cover {
    border-radius: 2rem;
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
    width: 100%;
    max-width: 100%;
    min-height: 100%;
    max-height: 100%;
}
.anime-pro-info {
    background: none;
    border-radius: 2.2rem 0 0 2.2rem;
    min-height: 340px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.anime-pro-title {
    font-weight: 800;
    color: #f29824;
    font-size: 2rem;
    margin-bottom: 0.5rem;
    letter-spacing: 1px;
}
.anime-pro-badge-main {
    background: linear-gradient(90deg, #ff4c60 0%, #ff8c42 100%);
    color: #fff;
    font-weight: 700;
    border-radius: 10px;
    padding: 0.55em 0.8em;
    font-size: 0.8rem;
    box-shadow: 0 2px 8px #ff4c6040;
}
.anime-pro-badge {
    background: #232526;
    color: #ff8c42;
    font-weight: 500;
    border-radius: 8px;
    font-size: 0.97rem;
    padding: 0.4em 0.9em;
}
.anime-pro-desc {
    color: #eee;
    font-size: 1rem;
    /* line-height: 1.7; */
    font-family: 'Poppins', sans-serif;
}
.anime-pro-episode-btn {
    border-radius: 10px;
    font-weight: 600;
    color: #ff8c42;
    border: 2px solid #ff8c42;
    background: #232526;
    transition: background 0.18s, color 0.18s, border 0.18s, box-shadow 0.18s;
    box-shadow: 0 1px 6px #ff4c6040;
    font-size: 0.8rem;
    padding: 0.45em 0.8em;
}
.anime-pro-episode-btn:hover {
    background: #f29824;
    color: #fff;
    border: 2px solid #f29824;
    box-shadow: 0 2px 12px #ff4c6040;
}
.anime-pro-like-btn {
    color: #ff8c42;
    font-weight: 700;
    border-radius: 10px;
    border: 2px solid #ff8c42;
    box-shadow: 0 2px 8px #ff4c6040;
    transition: background 0.18s, color 0.18s, box-shadow 0.18s;
    padding: 0.2em 0.8em;
    font-size: 0.8rem;
}
.anime-pro-like-btn.liked, .anime-pro-like-btn:active {
    background: linear-gradient(90deg, #ff8c42 0%, #ff8c42 100%);
    color: #fff;
    border: 2px solid #ff8c42;
}
.anime-pro-comments {
    background: rgba(34,36,40,0.97);
    border-radius: 1.5rem;
    box-shadow: 0 2px 12px #23252640;
    /* border: 2px solid #f29824; */
    border: 1px solid #ffffff43;
    padding: 2.2rem 2rem 1.2rem 2rem;
}
.anime-pro-textarea {
    width: 100%;
    border-radius: 12px;
    /* border: 2px solid #ff8c42; */
    background: rgba(30,30,40,0.92);
    color: #fff;
    font-size: 1.08rem;
    padding: 0.7em 1em;
    margin-bottom: 0.5rem;
    transition: border 0.18s, box-shadow 0.18s;
    resize: vertical;
}
.anime-pro-textarea:focus {
    border: 1px solid #f29824;
    outline: none;
    background: #232526;
}
.anime-pro-comment-btn {
    background: #f29824;
    color: #fff;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    box-shadow: 0 2px 8px #f29824;
    transition: background 0.18s, box-shadow 0.18s;
    padding: 0.5em 1.2em;
}
.anime-pro-comment-list {
    padding-right: 0;
}
.anime-pro-comment {
    background: rgba(30,30,40,0.85);
    border-radius: 0.9rem;
    color: #fff;
    /* box-shadow: 0 1px 6px #ff4c6040; */
    padding: 1rem 1.2rem;
    display: flex;
    align-items: flex-start;
    gap: 1.1rem;
}
.anime-pro-comment-avatar img {
    object-fit: cover;
    border-radius: 50%;
    /* border: 1px solid #c0c0c0; */
    /* box-shadow: 0 2px 8px #ff4c6040; */
}
.anime-pro-comment-text {
    font-size: 1.05rem;
    color: #eee;
    margin-top: 0.2em;
}
@media (max-width: 900px) {
    .anime-pro-card {
        padding: 0.5rem;
    }
    .anime-pro-cover {
        border-radius: 1.2rem;
        min-height: 180px;
        max-height: 320px;
        max-width: 98vw;
    }
    .anime-pro-info {
        border-radius: 1.2rem 1.2rem 0 0;
        min-height: 120px;
    }
}
@media (max-width: 600px) {
    .anime-pro-card {
        border-radius: 1rem;
        padding: 0rem;
    }
    .anime-pro-cover-wrap {
        min-height: 100px;
    }

    .anime-pro-info {
        border-radius: 1rem 1rem 0 0;
        min-height: 80px;
        /* padding: 1.2rem 0.7rem; */
    }
    .anime-pro-comments {
        border-radius: 0.7rem;
        padding: 1rem 0.5rem;
    }
}
.anime-episode-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 12px;
  margin-bottom: 0.5rem;
}
.anime-episode-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #232526;
  color: #ff8c42;
  border: 2px solid #ff8c42;
  border-radius: 12px;
  font-weight: 600;
  font-size: 0.8rem;
  padding: 0.7em 0.2em;
  text-decoration: none;
  transition: background 0.18s, color 0.18s, border 0.18s, box-shadow 0.18s;
  box-shadow: 0 1px 6px #ff4c6040;
}
.anime-episode-badge:hover, .anime-episode-badge:focus {
  background: #f29824;
  color: #fff;
  border: 2px solid #f29824;
  box-shadow: 0 2px 12px #ff4c6040;
}
</style>
{% endblock %}
